#= require firebase
#= require firebase-simple-login

params = window.location.search.substring(1).split("&")
  .map (el) -> el.split "="

behavior = params[0][0]

if behavior in ['broadcast', 'follow']
  ref = new Firebase "<%= site.config['firebase'] %>"

if behavior is 'broadcast'
  logoutBtn = $('#auth-logout')
  loginBtn = $('#auth-login')

  auth = new FirebaseSimpleLogin ref, (error, user) ->
   if user
      loginBtn.hide()
      logoutBtn.show()
    else
      logoutBtn.hide()
      loginBtn.show()

  logoutBtn.click -> auth.logout()
  loginBtn.click -> auth.login 'github', {rememberMe: true}

  $(document).bind 'deck.change', (event, from, to) ->
    ref.set {'slide': to}

else if behavior is 'follow'
  ref.child 'slide'
  .on 'value', (value) -> $.deck('go', value.val())
