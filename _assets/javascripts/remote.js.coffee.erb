#= require firebase
#= require firebase-simple-login
#= require bower-parseuri

'use strict'

parseUri.options.strictMode = true
uri_keys = parseUri(document.URL).queryKey

follow = uri_keys.follow
broadcast = uri_keys.broadcast

if follow or broadcast
  ref = new Firebase "<%= site.config['firebase'] %>"

if broadcast
  logoutBtn = $('#auth-logout')
  loginBtn = $('#auth-login')

  auth = new FirebaseSimpleLogin ref, (error, user) ->
   if user
      loginBtn.hide()
      logoutBtn.show()
    else
      logoutBtn.hide()
      loginBtn.show()

  logoutBtn.click -> auth.logout()
  loginBtn.click -> auth.login 'github', {rememberMe: true}

  $(document).bind 'deck.change', (event, from, to) ->
    ref.set {'slide': to}

else if follow
  $('.notes-link').hide()
  ref.child 'slide'
  .on 'value', (value) -> $.deck('go', value.val())
